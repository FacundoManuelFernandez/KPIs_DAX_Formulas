Promedio de Cuotas Concretadas =
VAR PagosConCuotas =
    ADDCOLUMNS(
        'TablaPagos',
        "CuotaReal",
            LOOKUPVALUE(
                'TablaClasificacionCuotas'[Cuotas Reales],
                'TablaClasificacionCuotas'[Cuotas S/Clasificacion Sistema],
                'TablaPagos'[Cantidad de cuotas]
            ),
        "PagosRealizados",
            CALCULATE(
                COUNTROWS('TablaPagos'),
                'TablaPagos'[Estado de pago] = "Realizado"
            ),
        "PagosAnulados",
            CALCULATE(
                COUNTROWS('TablaPagos'),
                'TablaPagos'[Estado de pago] = "Anulado"
            )
    )
VAR CuotasPonderadas =
    SUMX(
        PagosConCuotas,
        VAR CuotaReal = [CuotaReal]
        VAR PagosConcretados = [PagosRealizados] - [PagosAnulados]
        RETURN
            IF(
                NOT(ISBLANK(CuotaReal)),
                CuotaReal * PagosConcretados,
                0
            )
    )
VAR TotalPagosConcretados =
    SUMX(
        PagosConCuotas,
        VAR CuotaReal = [CuotaReal]
        VAR PagosConcretados = [PagosRealizados] - [PagosAnulados]
        RETURN
            IF(
                NOT(ISBLANK(CuotaReal)),
                PagosConcretados,
                0
            )
    )
RETURN
    IF(
        TotalPagosConcretados = 0,
        BLANK(),
        DIVIDE(CuotasPonderadas, TotalPagosConcretados)
    )

